<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <!--<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>-->
    <title>保险报价</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="css/reset.css">
    <style>
        .box{
            width: 100%;
        }
        .top{
            width: 100%;
            color: #333333;
            padding: 10px 0 10px 15px ;
            font-size: 15px;
            font-weight: bold;

        }

        .header{
            width: 100%;
            height: 70px;
            background: -webkit-linear-gradient(left, #438EFF , #50CCFF); /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(right, #438EFF , #50CCFF); /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(right, #438EFF , #50CCFF); /* Firefox 3.6 - 15 */
            background: linear-gradient(to right, #438EFF , #50CCFF);
        }
        .header .header-active{
            height: 70px;
            line-height: 70px;
            padding-left: 15px;
            position: relative;
            float: left;
        }

        .header .header-active img{
            position: absolute;
            top: 26px;
            left: 17px;
            width: 22px;
            height: 18px;
            display: inline-block;

        }
        .header .header-active span{
           padding-left: 39px;
           color: #fff;
           font-size: 17px;

        }
        .header .header-right{
           padding-top: 15px;
           padding-right: 8px;
           float: right;
        }
        .header .header-right p{
            padding: 3px 0;
           color: #fff;
           font-size: 12px;
        }
        .header .header-right p b{
           color: #fff;
           font-size: 12px;
        }
        .main{
            width: 90%;

            margin: 0 auto;
        }
        .main-content{
            width: 100%;

            margin-top: 8px;
        }
        .main-content ul li{
            width: 100%;
            padding: 4px 0;
            font-size: 15px;
            color: #333333;
        }
        .main-content ul li span{

            font-size: 15px;

        }
        .main-content ul li .li-left{
            float: left;

        }
        .main-content ul li .li-right{
            float: right;

        }
        .main-content ul li.self-li{
            opacity: 0.5;

        }
        .main-content ul li.self-style-li span{
            font-size: 16px;
            font-weight:bold;

        }

        .footer{
            width: 90%;
            margin: 20px auto 10px;

        }
        .footer .footer-img{
            width: 130px;
            height: 130px;
            margin: 5px auto;
        }
        .footer .footer-img img{
            width: 100%;
        }
        .footer p{
            text-align: left;
            color: #999999;
            font-size: 12px;
            line-height: 20px;
            /*word-wrap : break-word ;*/
        }
        .footer p span{
            color: #999999;
        }
        .footer p.self-color{
           color: #999999;
            text-align: center;
            width: 65%;
            margin: 20px auto 0;
        }
        .newimg img{
            display: block;
            margin: 0 auto;
            width: 90%;
        }
    </style>
</head>
<body>
    <div class="box">
        <div class="top">
           尊敬的车主，您的爱车车险初始报价为：
        </div>

        <div class="header">
                <div class="header-active">
                    <img src="img/icon-car1.png" alt="...">
                    <span id="car-header"></span>
                </div>
                <div class="header-right">
                    <p id="tpfDate">交强险起保日期：<b id="tpfEffectDate"></b></p>
                    <p id="bizDate">商业险起保日期：<b id="bizEffectDate"></b></p>
                </div>



        </div>
        <div class="main">
            <div class="main-content">
                <ul>
                    <li class="clearfix" id="tpf">
                        <span class="li-left">交强险</span>
                        <span class="li-right" id="tpfPremium">￥</span>
                    </li>
                    <li class="clearfix" id="biz">
                        <span class="li-left">商业险</span>
                        <span class="li-right" id="bizPremium">￥</span>
                    </li>
                    <li class="clearfix self-li">
                        <span class="li-left">第三者责任险 50万</span>
                        <span class="li-right" id="coveragePremium">￥</span>
                    </li>
                    <li class="clearfix self-li">
                        <span class="li-left">不计免赔</span>
                        <span class="li-right" id="noDedPremium">￥</span>
                    </li>
                    <li class="clearfix ">
                        <span class="li-left">车船税</span>
                        <span class="li-right" id="sumTaxAmount">￥</span>
                    </li>
                    <div style="border-bottom:1px solid #E3E4E8;margin: 5px 0; "></div>
                    <li class="clearfix self-style-li">
                        <span class="li-left">汇总金额</span>
                        <span class="li-right" id="accountM" style="color: #FF9738;">￥</span>
                    </li>
                </ul>

            </div>

        </div>
        <div class="footer">

            <div class="footer-img" id="footer-erwei"></div>

            <p>请截图保存上图二维码,并打开微信"扫一扫"->"相册",选中二维码图片扫描并关注“<span>好修修</span>”公众号,您将获取精准报价</p>
            <p class="self-color">该车险由太平财险承保，正隆提供保险销售服务，好修修提供技术支持</p>
        </div>
        <div class="newimg">
            <img src="img/info1.png" alt="...">
        </div>

    </div>

    <script src="/lib/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">

        function GetRequest() {
            var url = location.search; //获取url中"?"符后的字串
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for(var i = 0; i < strs.length; i ++) {
                    theRequest[strs[i].split("=")[0]]=decodeURI(strs[i].split("=")[1]);
                }
            }

            return theRequest;
        }
        let urlData=GetRequest();

        // console.log('请求到的链接数据',urlData);


        if(urlData['id']){
            // $.get('http://api.hoxiuxiu.com/Query?code=7012&id='+urlData['id'],function(data,status){
            $.get('/proxy/Query?code=7012&id='+urlData['id'],function(data,status){
                let getUser=JSON.parse(data);
                // console.log(getUser,getUser[0]['licenseNo'],getUser[0]['did']);
                if(getUser[0]['licenseNo']&&getUser[0]['did']){
                        $('#car-header').append(getUser[0]['licenseNo']);
                        // let strUrl="http://api.qixiu.hoxiuxiu.com/insurance/quotation/"+getUser[0]['licenseNo'];
                        let strUrl="/proxy-qixiu/insurance/quotation/"+getUser[0]['licenseNo'];
                        $.get(strUrl,function(data,status){

                            if(data&&data["responseList"][0]['header']['resultCode']=="0000"){

                                let getData=data["responseList"][0];
                                // console.log(getData);

                                if(getData['baseInfo'].hasOwnProperty("tpfEffectDate")){
                                    $('#tpfEffectDate').append((getData['baseInfo']['tpfEffectDate']).substr(0, 10));
                                    $('#tpfPremium').append(getData['baseInfo']['tpfPremium']);
                                }else if(getData['baseInfo'].hasOwnProperty("bizEffectDate")){
                                    $('#tpfEffectDate').append('未到期');
                                    $("#tpf").hide();
                                }else{
                                    $('#tpfDate').hide();
                                    $("#tpf").hide();
                                }

                                if(getData['baseInfo'].hasOwnProperty("bizEffectDate")){
                                    $('#bizEffectDate').append((getData['baseInfo']['bizEffectDate']).substr(0, 10));
                                    $('#bizPremium').append(getData['baseInfo']['bizPremium']);
                                }else if(getData['baseInfo'].hasOwnProperty("tpfEffectDate")){
                                    $('#bizEffectDate').append('未到期');
                                    $("#biz").hide();
                                }else{
                                    $('#bizDate').hide();
                                    $("#biz").hide();
                                }


                                let coveragePremium=0;
                                let noDedPremium=0;
                                if(getData.hasOwnProperty("bizCoverage")){
                                    if(getData["bizCoverage"].hasOwnProperty("coverageInfoList")){
                                        for(let i in getData['bizCoverage']['coverageInfoList']){
                                            if(getData['bizCoverage']['coverageInfoList'][i]['coverageCode']=="B"){
                                                coveragePremium=getData['bizCoverage']['coverageInfoList'][i]['coveragePremium'];
                                            }else if(getData['bizCoverage']['coverageInfoList'][i]['coverageCode']=="M"){
                                                noDedPremium=getData['bizCoverage']['coverageInfoList'][i]['coveragePremium'];
                                            }
                                        }

                                    }else{
                                        coveragePremium=0;
                                        noDedPremium=0;
                                    }
                                }else{
                                    coveragePremium=0;
                                    noDedPremium=0;
                                }

                                $('#coveragePremium').append(coveragePremium);
                                $('#noDedPremium').append(noDedPremium);

                                let sumTaxAmount=0;//车船税
                                if(getData.hasOwnProperty("vehicleTaxInfo")){
                                    if(getData['vehicleTaxInfo'].hasOwnProperty("sumTaxAmount")){
                                        sumTaxAmount=getData['vehicleTaxInfo']['sumTaxAmount'];
                                    }else{
                                        sumTaxAmount=0;
                                    }
                                }else{
                                    sumTaxAmount=0;
                                }

                                $('#sumTaxAmount').append(sumTaxAmount);










                                let accountMoney=((getData['baseInfo']['bizPremium']||0)+
                                                    (getData['baseInfo']['tpfPremium']||0)+
                                                    coveragePremium+
                                                    noDedPremium+
                                                    sumTaxAmount).toFixed(2);
                                $('#accountM').append(accountMoney);
                            }
                        });

                        // let imgStrUrl='http://api.qixiu.hoxiuxiu.com/insurance/weixin/qrcode?did='+getUser[0]['did'];
                        let imgStrUrl='/proxy-qixiu/insurance/weixin/qrcode?did='+getUser[0]['did'];
                        // console.log(imgStrUrl);
                        $.get(imgStrUrl,function(data,status){
                            //  console.log(data,status);
                            if(data){
                                let imgStr='<img src="'+data+'" alt="">';
                                    $('#footer-erwei').append(imgStr);
                            }
                        });
                }




            });

        }

    </script>
</body>
</html>
